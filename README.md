# üèì –õ–∏–≥–∞ –Ω–∞—Å—Ç–æ–ª—å–Ω–æ–≥–æ —Ç–µ–Ω–Ω–∏—Å–∞ ‚Äî Telegram Mini App

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏–≥–æ–π –Ω–∞—Å—Ç–æ–ª—å–Ω–æ–≥–æ —Ç–µ–Ω–Ω–∏—Å–∞: —Ä–µ–π—Ç–∏–Ω–≥, –¥–∏–≤–∏–∑–∏–æ–Ω—ã, –≤–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–∞—Ç—á–µ–π. Telegram Bot + Mini App (React) + Supabase.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
tg_tennis_league_bot/
‚îú‚îÄ‚îÄ bot/                  # Telegram-–±–æ—Ç (Python, aiogram 3)
‚îú‚îÄ‚îÄ frontend/             # Mini App (React + Vite + Tailwind)
‚îú‚îÄ‚îÄ database/             # –°—Ö–µ–º–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (Supabase)
‚îú‚îÄ‚îÄ scripts/              # –ò–º–ø–æ—Ä—Ç –∏–∑ CSV –∏ –¥—Ä.
‚îú‚îÄ‚îÄ .github/workflows/    # –î–µ–ø–ª–æ–π —Ñ—Ä–æ–Ω—Ç–∞ –Ω–∞ GitHub Pages
‚îî‚îÄ‚îÄ README.md
```

---

## 1. –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ –≤ @BotFather

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram.
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`, —É–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ username –±–æ—Ç–∞.
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ **—Ç–æ–∫–µ–Ω** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `123456:ABC-DEF...`). –û–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è `BOT_TOKEN`.

---

## 2. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ Supabase

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ [supabase.com](https://supabase.com) –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç.
2. –í **SQL Editor** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ **`database/schema.sql`** —Ü–µ–ª–∏–∫–æ–º.
3. –ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∏–º–ø–æ—Ä—Ç –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ CSV —Å `telegram_id = NULL`, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:
   - **`database/migrations/002_allow_null_telegram_id.sql`**
4. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –í—ã–ø–æ–ª–Ω–∏—Ç–µ **`database/seed.sql`** –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
5. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞ (**Settings ‚Üí API**) —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **Project URL** ‚Üí –¥–ª—è `SUPABASE_URL`
   - **anon public** ‚Üí –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞ –∏ –±–æ—Ç–∞ (–∏–ª–∏ **service_role** —Ç–æ–ª—å–∫–æ –¥–ª—è –±–æ—Ç–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –±–µ–∑ RLS)

### –ü–µ—Ä–µ–¥–∞—á–∞ –∫—Ä–µ–¥–æ–≤ –ë–î –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

| –ö—É–¥–∞ | –ß—Ç–æ –ø–µ—Ä–µ–¥–∞—Ç—å | –û—Ç–∫—É–¥–∞ –≤–∑—è—Ç—å |
|------|--------------|--------------|
| **bot/.env** | `SUPABASE_URL`, `SUPABASE_KEY` | Supabase ‚Üí Settings ‚Üí API (URL, anon –∏–ª–∏ service_role) |
| **frontend/.env** | `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY` | –¢–æ–ª—å–∫–æ **anon** –∫–ª—é—á (–Ω–µ service_role) |
| **GitHub Actions** | –°–µ–∫—Ä–µ—Ç—ã `VITE_SUPABASE_URL`, `VITE_SUPABASE_KEY` | –¢–æ—Ç –∂–µ URL –∏ anon –∫–ª—é—á (–¥–ª—è —Å–±–æ—Ä–∫–∏ —Ñ—Ä–æ–Ω—Ç–∞) |
| **Railway / Docker** | –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `SUPABASE_URL`, `SUPABASE_KEY` | –¢–µ –∂–µ –∑–Ω–∞—á–µ–Ω–∏—è, —á—Ç–æ –≤ bot/.env |

–§–∞–π–ª—ã `.env` –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å (–æ–Ω–∏ –≤ `.gitignore`). –°–∫—Ä–∏–ø—Ç `scripts/import_from_sheets.py` —á–∏—Ç–∞–µ—Ç –∫—Ä–µ–¥—ã –∏–∑ `bot/.env`; –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ –ë–î –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º RLS –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è `SUPABASE_SERVICE_KEY` (service_role) –≤ `bot/.env`.

---

## 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª—ã

### –ë–æ—Ç (`bot/.env`)

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `bot/.env.example` –≤ `bot/.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:

```env
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–æ—Ç_BotFather
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_KEY=–≤–∞—à_anon_–∏–ª–∏_service_role_–∫–ª—é—á
ADMIN_TELEGRAM_ID=–≤–∞—à_telegram_id
WEBAPP_URL=https://yourusername.github.io/—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π/tennis-league/
```

- **ADMIN_TELEGRAM_ID** ‚Äî –≤–∞—à Telegram ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ [@userinfobot](https://t.me/userinfobot)), –¥–ª—è –∞–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥ –∏ –æ—Ç—á—ë—Ç–∞ –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Ç—É—Ä–∞.
- **WEBAPP_URL** ‚Äî URL Mini App –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ GitHub Pages.

### –§—Ä–æ–Ω—Ç–µ–Ω–¥ (`frontend/.env`)

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `frontend/.env.example` –≤ `frontend/.env`:

```env
VITE_SUPABASE_URL=https://xxxxx.supabase.co
VITE_SUPABASE_ANON_KEY=–≤–∞—à_anon_–∫–ª—é—á
```

---

## 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
cd bot
pip install -r requirements.txt
python main.py
```

–ë–æ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ long polling. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ **23:55** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø–æ—Å–ª–µ–¥–Ω–∏–π –ª–∏ –¥–µ–Ω—å –º–µ—Å—è—Ü–∞; –µ—Å–ª–∏ –¥–∞ ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ç—É—Ä –∏ —Å–æ–∑–¥–∞—ë—Ç —Å–ª–µ–¥—É—é—â–∏–π —Å–µ–∑–æ–Ω —Å —Ä–æ—Ç–∞—Ü–∏–µ–π.

---

## 5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å GitHub Pages –¥–ª—è frontend

1. –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞ GitHub: **Settings ‚Üí Pages**.
2. –í —Ä–∞–∑–¥–µ–ª–µ **Build and deployment** –≤—ã–±–µ—Ä–∏—Ç–µ **Source: GitHub Actions**.
3. –í **Settings ‚Üí Secrets and variables ‚Üí Actions** –¥–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã:
   - **VITE_SUPABASE_URL** ‚Äî Project URL –∏–∑ Supabase.
   - **VITE_SUPABASE_KEY** ‚Äî anon public –∫–ª—é—á –∏–∑ Supabase.
4. –ü–æ—Å–ª–µ –ø—É—à–∞ –≤ –≤–µ—Ç–∫—É **main** —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ **frontend/** workflow —Å–æ–±–µ—Ä—ë—Ç –ø—Ä–æ–µ–∫—Ç –∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –µ–≥–æ –Ω–∞ GitHub Pages.
5. URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥–µ—Ç: `https://<username>.github.io/<repo>/tennis-league/` (–µ—Å–ª–∏ –≤ `vite.config.js` —É–∫–∞–∑–∞–Ω–æ `base: '/tennis-league/'`).

–ß—Ç–æ–±—ã –≤ —Å–±–æ—Ä–∫–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `npm ci`, –∑–∞–∫–æ–º–º–∏—Ç—å—Ç–µ **`frontend/package-lock.json`** (—Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–æ—Å–ª–µ `npm install` –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `frontend`).

---

## 6. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å Mini App –≤ @BotFather

1. –í [@BotFather](https://t.me/BotFather) –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞.
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É **/newapp** (–∏–ª–∏ —á–µ—Ä–µ–∑ –º–µ–Ω—é: Bot Settings ‚Üí Menu Button).
3. –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ URL –≤–∞—à–µ–≥–æ Mini App (—Ç–æ—Ç –∂–µ **WEBAPP_URL**, –Ω–∞–ø—Ä–∏–º–µ—Ä `https://yourusername.github.io/your-repo/tennis-league/`).
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–∏–≤—è–∂–∏—Ç–µ Mini App –∫ –∫–Ω–æ–ø–∫–µ –º–µ–Ω—é –±–æ—Ç–∞.

---

## 7. –î–µ–ø–ª–æ–π –±–æ—Ç–∞ –Ω–∞ Railway

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ [Railway CLI](https://docs.railway.app/develop/cli) (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω).
2. –í –∫–∞—Ç–∞–ª–æ–≥–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
railway login
railway init
```

3. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Railway (Dashboard –∏–ª–∏ `railway variables`):
   - `BOT_TOKEN`
   - `SUPABASE_URL`
   - `SUPABASE_KEY`
   - `ADMIN_TELEGRAM_ID`
   - `WEBAPP_URL`

4. –î–µ–ø–ª–æ–π –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ **bot**:

```bash
cd bot
railway up
```

–õ–∏–±–æ —É–∫–∞–∂–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–µ—Ä–≤–∏—Å–∞ Railway –∫–æ—Ä–µ–Ω—å —Å–±–æ—Ä–∫–∏ **bot** –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–Ω—ã–π **Dockerfile** (–≤ `bot/Dockerfile`):

- **Build**: Dockerfile –≤ `bot/`.
- **Start**: `python main.py`.

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### –ò–º–ø–æ—Ä—Ç –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ CSV (—ç–∫—Å–ø–æ—Ä—Ç –∏–∑ Google Sheets)

–ï—Å–ª–∏ –≤—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏ —Ç–∞–±–ª–∏—Ü—É –≤ CSV (–§–∞–π–ª ‚Üí –°–∫–∞—á–∞—Ç—å ‚Üí CSV):

```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
python scripts/import_from_sheets.py path/to/export.csv
```

–í CSV –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ–ª–æ–Ω–∫–∏ **–ò–º—è** (–∏–ª–∏ `name`) –∏ **–†–µ–π—Ç–∏–Ω–≥** (–∏–ª–∏ `rating`). –ò–≥—Ä–æ–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å `telegram_id = NULL`; –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ `/start`, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —Å–≤—è–∑–∞—Ç—å –∑–∞–ø–∏—Å—å –ø–æ –∏–º–µ–Ω–∏ –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –ª–æ–≥–∏–∫—É –≤ –±–æ—Ç–µ.

–ü–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é **`database/migrations/002_allow_null_telegram_id.sql`**.

### Docker (–±–æ—Ç)

```bash
cd bot
docker build -t tennis-league-bot .
docker run --env-file .env tennis-league-bot
```

### –†–µ–≥–ª–∞–º–µ–Ω—Ç –∏ —Ä–µ–π—Ç–∏–Ω–≥

- –¢—É—Ä = 1 –º–µ—Å—è—Ü; –≤ –¥–∏–≤–∏–∑–∏–æ–Ω–µ –≤—Å–µ –∏–≥—Ä–∞—é—Ç –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º.
- –ú–∞—Ç—á: –¥–æ 3 –ø–æ–±–µ–¥ (Best of 5). –û—á–∫–∏: –ø–æ–±–µ–¥–∞ 2, –ø–æ—Ä–∞–∂–µ–Ω–∏–µ 1, –Ω–µ—Å—ã–≥—Ä–∞–Ω–Ω—ã–π 0.
- –†–æ—Ç–∞—Ü–∏—è: —Ç–æ–ø-2 –≤–≤–µ—Ä—Ö, –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –≤–Ω–∏–∑ (–µ—Å–ª–∏ –≤ –¥–∏–≤–∏–∑–∏–æ–Ω–µ >8 ‚Äî –ø–æ 3).
- –†–µ–π—Ç–∏–Ω–≥ –ø–æ —Ñ–æ—Ä–º—É–ª–∞–º –§–ù–¢–† (–ö–î –ø–æ –¥–∏–≤–∏–∑–∏–æ–Ω—É, –ö–° –ø–æ —Å—á—ë—Ç—É). –ù–æ–≤—ã–π –∏–≥—Ä–æ–∫: —Ä–µ–π—Ç–∏–Ω–≥ 100, –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–∏–≤–∏–∑–∏–æ–Ω.

–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Äî –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–ü—Ä–∞–≤–∏–ª–∞¬ª –≤ Mini App –∏ –≤ **context_project.md**.
